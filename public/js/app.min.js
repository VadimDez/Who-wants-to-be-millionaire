/*! 1mil 2014-12-28 */
"use strict";angular.module("addCtrl",["questionService","ngAnimate"]).controller("AddController",["$scope","Question",function($scope,Question){function check(){return!(0==$scope.question.length||0==$scope.answerA.length||0==$scope.answerB.length||0==$scope.answerC.length||0==$scope.answerD.length)}$scope.correctAnswer="A",$scope.added=!1,$scope.add=function(){return check()?void Question.create({question:$scope.question,answerA:$scope.answerA,answerB:$scope.answerB,answerC:$scope.answerC,answerD:$scope.answerD,correctAnswer:$scope.correctAnswer}).success(function(){$scope.added=!0}):!1},$scope.addMore=function(){$scope.added=!1,$scope.question=$scope.answerA=$scope.answerB=$scope.answerC=$scope.answerD="",$scope.correctAnswer="A"}}]),angular.module("audioCtrl",["ngAudio","audioPlayerModule"]).controller("AudioController",["$scope","ngAudio","AudioPlayer",function($scope,ngAudio,AudioPlayer){$scope.turned=!1;var url="/audio/background.mp3";AudioPlayer[url]?$scope.music=AudioPlayer[url]:($scope.music=ngAudio.load(url),$scope.music.volume=.5,$scope.music.loop=!0,AudioPlayer[url]=$scope.music),$scope.turnOff=function(){$scope.music.pause(),$scope.turned=!1},$scope.turnOn=function(){$scope.music.play(),$scope.turned=!0}}]),angular.module("endGameCtrl",["ui.bootstrap","playerService"]).controller("EndGameController",["$scope","$modalInstance","name","points","won","Player",function($scope,$modalInstance,name,points,won,Player){$scope.won=won,Player.create(name,points),$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("helpCtrl",["ui.bootstrap"]).controller("HelpController",["$scope","$modalInstance","name","answer","type",function($scope,$modalInstance,name,answer,type){function getRandomAnswer(){return answers[Math.floor(3*Math.random())]}function getRandomPercentage(){var percentage=100,random=100*Math.random();$scope.answer={},percentage-=random,$scope.answer[answer]=random,$.each(answers,function(k,value){$scope.answer[value]=Math.random()*percentage,percentage-=$scope.answer[value]})}var answers=["A","B","C","D"];answers.splice($.inArray(answer,answers),1),$scope.type=type,"call"==type?($scope.name=name,$scope.answer=Math.random()>.9?getRandomAnswer():answer):getRandomPercentage(),$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("indexCtrl",["playerFilter","questionService","ui.bootstrap","ngAudio","audioPlayerModule","endGameCtrl","helpCtrl","counterService"]).controller("IndexController",["$scope","NameFilter","Question","$modal","ngAudio","AudioPlayer","CountDown",function($scope,NameFilter,Question,$modal,ngAudio,AudioPlayer,CountDown){function game(){setAllAnswersAvailable(!0),soundNext.currentTime>0&&(soundNext.currentTime=0),CountDown.stop(),CountDown.start(time,1e3,function(seconds){$scope.countDown=seconds,0==seconds&&(launchModal(!1),setVars())}),soundNext.play(),question=questions[$scope.level],$scope.question={question:question.question,answerA:question.answerA,answerB:question.answerB,answerC:question.answerC,answerD:question.answerD}}function launchModal(won,points){soundLose.play();var modalInstance=$modal.open({templateUrl:won?"/views/modals/won.html":"/views/modals/lost.html",controller:"EndGameController",size:"sm",resolve:{name:function(){return $scope.playerName},points:function(){return points},won:function(){return won}}});modalInstance.result.then(function(){},function(){})}function audio(url){if(AudioPlayer[url])return AudioPlayer[url];var sound=ngAudio.load(url);return sound.volume=.5,AudioPlayer[url]=sound,sound}function setAllAnswersAvailable(value){$scope.showA=$scope.showB=$scope.showC=$scope.showD=value}function setVars(){$scope.level=0,$scope.countDown=time,$scope.hideNewGame=!1,$scope.helpHalfAvailable=!0,$scope.helpCallAvailable=!0,$scope.helpVoteAvailable=!0,points=0}$scope.playerName="";var points,time=30;setVars();var question=null,questions=null,available=!1,soundNext=audio("/audio/Page_Turn.wav"),soundLose=audio("/audio/Blop.wav");Question.get15().success(function(_questions){15===_questions.length&&(available=!0),questions=_questions}),$scope.newGame=function(){NameFilter($scope.playerName)&&available&&($scope.hideNewGame=!0,game())},$scope.answer=function(Letter){return available&&question&&-1==$.inArray(Letter,["A","B","C","D"])?!1:void(Letter==window.atob(question.correctAnswer)?(points+=$scope.level*CountDown.left(),$scope.level++,$scope.level>=15?launchModal(!0):game()):(launchModal(!1),setVars()))},$scope.helpHalf=function(){if(!question||!$scope.helpHalfAvailable)return!1;$scope.helpHalfAvailable=!1;var correct=[window.atob(question.correctAnswer)],answers=["A","B","C","D"];answers.splice($.inArray(window.atob(question.correctAnswer),answers),1),correct.push(answers[Math.floor(3*Math.random())]),setAllAnswersAvailable(!1);for(var c=0;2>c;c++)$scope["show"+correct[c]]=!0},$scope.helpCall=function(){if(!question||!$scope.helpCallAvailable)return!1;$scope.helpCallAvailable=!1;var modalInstance=$modal.open({templateUrl:"/views/modals/help.html",controller:"HelpController",size:"md",resolve:{name:function(){return $scope.playerName},answer:function(){return window.atob(question.correctAnswer)},type:function(){return"call"}}});modalInstance.result.then(function(){},function(){})},$scope.helpVote=function(){if(!question||!$scope.helpVoteAvailable)return!1;$scope.helpVoteAvailable=!1;var modalInstance=$modal.open({templateUrl:"/views/modals/help.html",controller:"HelpController",size:"md",resolve:{name:function(){return $scope.playerName},answer:function(){return window.atob(question.correctAnswer)},type:function(){return"vote"}}});modalInstance.result.then(function(){},function(){})},$scope.$on("$destroy",function(){CountDown.stop()})}]),angular.module("leaderBoardCtrl",["playerService"]).controller("LeaderBoardController",["$scope","Player",function($scope,Player){Player.get16().success(function(_players){$scope.players=_players})}]),angular.module("playerFilter",[]).filter("Name",function(){return function(string){return string?(string=string.trim(),0!==string.length&&""!==string):!1}}),angular.module("audioPlayerModule",[]).value("AudioPlayer",{}),angular.module("counterService",[]).factory("CountDown",function(){var timer,seconds;return{start:function(_seconds,_interval,callBack){seconds=_seconds,timer=setInterval(function(){0==seconds&&clearInterval(timer),"function"==typeof callBack&&callBack(seconds),seconds--},_interval||1e3)},stop:function(){clearInterval(timer)},left:function(){return seconds}}}),angular.module("playerService",[]).factory("Player",["$http",function($http){return{create:function(name,points){return $http.post("/api/player",{name:name,points:points})},get16:function(){return $http.get("/api/player")}}}]),angular.module("questionService",[]).factory("Question",["$http",function($http){return{create:function(questionData){return $http.post("/api/question",questionData)},get15:function(){return $http.get("/api/question/get15")}}}]),angular.module("directives",[]).directive("openModal",function(){return{link:function(scope,element){function openModal(){var $element=angular.element("#myModal");$element.modal("show")}element.bind("click",openModal)}}});