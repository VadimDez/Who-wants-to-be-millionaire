/*! 1mil 2014-12-26 */
"use strict";angular.module("AddController",["QuestionService"]).controller("AddCtrl",["$scope","Question",function($scope,Question){$scope.correctAnswer="A",$scope.added=!1,$scope.add=function(){Question.create({question:$scope.question,answerA:$scope.answerA,answerB:$scope.answerB,answerC:$scope.answerC,answerD:$scope.answerD,correctAnswer:$scope.correctAnswer}).success(function(){$scope.added=!0})},$scope.addMore=function(){$scope.added=!1,$scope.question=$scope.answerA=$scope.answerB=$scope.answerC=$scope.answerD="",$scope.correctAnswer="A"}}]),angular.module("AudioController",["ngAudio","AudioPlayerModule"]).controller("AudioCtrl",["$scope","ngAudio","AudioPlayer",function($scope,ngAudio,AudioPlayer){$scope.turned=!1;var url="/audio/background.mp3";AudioPlayer[url]?$scope.music=AudioPlayer[url]:($scope.music=ngAudio.load(url),$scope.music.volume=.5,$scope.music.loop=!0,AudioPlayer[url]=$scope.music),$scope.turnOff=function(){$scope.music.pause(),$scope.turned=!1},$scope.turnOn=function(){$scope.music.play(),$scope.turned=!0}}]),angular.module("EndGameController",["ui.bootstrap","PlayerService"]).controller("EndGameCtrl",["$scope","$modalInstance","name","points","won","Player",function($scope,$modalInstance,name,points,won,Player){console.log(name),console.log(points),console.log(won),$scope.won=won,Player.create(name,points),$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("IndexController",["PlayerFilter","QuestionService","ui.bootstrap","ngAudio","AudioPlayerModule"]).controller("IndexCtrl",["$scope","NameFilter","Question","$modal","ngAudio","AudioPlayer",function($scope,NameFilter,Question,$modal,ngAudio,AudioPlayer){function game(){setAllAnswersAvailable(!0),soundNext.currentTime>0&&(soundNext.currentTime=0),soundNext.play(),question=questions[$scope.level],$scope.question={question:question.question,answerA:question.answerA,answerB:question.answerB,answerC:question.answerC,answerD:question.answerD}}function launchModal(won){soundLose.play();var modalInstance=$modal.open({templateUrl:won?"/views/modal_won.html":"/views/modal_lost.html",controller:"EndGameCtrl",size:"sm",resolve:{name:function(){return $scope.playerName},points:function(){return $scope.level},won:function(){return won}}});modalInstance.result.then(function(){},function(){})}function audio(url){if(AudioPlayer[url])return AudioPlayer[url];var sound=ngAudio.load(url);return sound.volume=.5,AudioPlayer[url]=sound,sound}function setAllAnswersAvailable(value){$scope.showA=$scope.showB=$scope.showC=$scope.showD=value}function setVars(){$scope.level=0,$scope.hideNewGame=!1,$scope.helpHalfAvailable=!0}$scope.playerName="",setVars();var question=null,questions=null,available=!1,soundNext=audio("/audio/Page_Turn.wav"),soundLose=audio("/audio/Blop.wav");Question.get16().success(function(_questions){16===_questions.length&&(available=!0),questions=_questions}),$scope.newGame=function(){NameFilter($scope.playerName)&&available&&($scope.hideNewGame=!0,game())},$scope.answer=function(Letter){return available&&question&&-1==$.inArray(Letter,["A","B","C","D"])?!1:void(Letter==window.atob(question.correctAnswer)?($scope.level++,$scope.level>=16?launchModal(!0):game()):(launchModal(!1),setVars()))},$scope.helpHalf=function(){if(!question||!$scope.helpHalfAvailable)return!1;$scope.helpHalfAvailable=!1;var correct=[window.atob(question.correctAnswer)],answers=["A","B","C","D"];answers.splice($.inArray(window.atob(question.correctAnswer),answers),1),correct.push(answers[Math.floor(Math.random()*answers.length)]),setAllAnswersAvailable(!1);for(var c=0;2>c;c++)$scope["show"+correct[c]]=!0}}]),angular.module("LeaderBoardController",["PlayerService"]).controller("LeaderBoardCtrl",["$scope","Player",function($scope,Player){Player.get16().success(function(_players){$scope.players=_players})}]),angular.module("PlayerFilter",[]).filter("Name",function(){return function(string){return string?(string=string.trim(),0!==string.length&&""!==string):!1}}),angular.module("AudioPlayerModule",[]).value("AudioPlayer",{}),angular.module("PlayerService",[]).factory("Player",["$http",function($http){return{create:function(name,points){return $http.post("/api/player",{name:name,points:points})},get16:function(){return $http.get("/api/player")}}}]),angular.module("QuestionService",[]).factory("Question",["$http",function($http){return{create:function(questionData){return $http.post("/api/question",questionData)},get16:function(){return $http.get("/api/question/get16")}}}]),angular.module("Directives",[]).directive("openModal",function(){return{link:function(scope,element){function openModal(){var $element=angular.element("#myModal");$element.modal("show")}element.bind("click",openModal)}}});